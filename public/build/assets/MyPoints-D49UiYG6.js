import{l as H,p as $,j as i,k as I,c as A,o,w as y,a as e,g as a,h as u,b as r,d as _,t as l,n as F,F as E,r as N}from"./app-BmtqsL1k.js";import{_ as O}from"./AppLayout.vue_vue_type_script_setup_true_lang-Ble2OSDe.js";import{_ as V}from"./Heading.vue_vue_type_script_setup_true_lang-Cvt8WFMJ.js";import{_ as C}from"./AppLogoIcon.vue_vue_type_script_setup_true_lang-jcm6BKT1.js";import{_ as n}from"./Icon.vue_vue_type_script_setup_true_lang-Uebf9f5Y.js";/* empty css            */import"./createLucideIcon-6njab1rV.js";import"./useForwardExpose-Crs7NE2t.js";import"./RovingFocusGroup-BmkD-kIC.js";import"./x-CAInKn2B.js";import"./save-DQuJ6KMF.js";import"./check-kxm3lot7.js";import"./chevron-down-DCl2u-jb.js";import"./eye-BkstkJV9.js";import"./loader-circle-BYLUlrRj.js";import"./sun-7iVVO116.js";import"./trash-2-DK3anBPA.js";const W={class:"p-6"},D={class:"mb-6"},G={class:"mt-4 flex items-center justify-between"},K={class:"grid gap-6 md:grid-cols-2 lg:grid-cols-3"},Y={class:"bg-white rounded-lg shadow-sm border p-6"},J={class:"flex items-center justify-between mb-4"},Q={class:"w-10 h-10 bg-blue-100 rounded-full flex items-center justify-center"},U={key:0,class:"text-center py-8"},Z={key:1,class:"text-center py-8"},ee={class:"text-red-600"},te={key:2,class:"text-center"},se={class:"text-3xl font-bold text-blue-600 mb-2"},oe={key:0,class:"mt-3"},ae={class:"mt-4 text-sm text-gray-500 space-y-1"},le={key:0},re={key:1},ne={key:1,class:"mt-4 p-3 bg-yellow-50 rounded-lg border border-yellow-200"},ie={class:"bg-white rounded-lg shadow-sm border p-6"},de={class:"flex items-center justify-between mb-4"},ce={class:"w-10 h-10 bg-green-100 rounded-full flex items-center justify-center"},ue={key:0,class:"space-y-3"},me={key:1,class:"text-center py-8"},pe={key:2,class:"space-y-3"},xe={class:"font-medium text-gray-900"},be={class:"text-sm text-gray-500"},ge={class:"bg-white rounded-lg shadow-sm border p-6"},ve={class:"flex items-center justify-between mb-4"},fe={key:0,class:"text-sm text-gray-600 mt-1"},ye={class:"w-10 h-10 bg-purple-100 rounded-full flex items-center justify-center"},_e={key:0,class:"text-center py-8"},he={key:1,class:"text-center py-8"},we={key:2,class:"space-y-3"},ke={class:"flex items-center justify-between"},Re={class:"flex-1"},Ce={class:"font-medium text-gray-900"},je={class:"text-sm text-gray-600 mt-1"},Pe={class:"mt-2 flex items-center space-x-2"},Te={class:"px-2 py-1 text-xs font-medium bg-purple-100 text-purple-800 rounded-full"},Ee={key:0,class:"px-2 py-1 text-xs font-medium bg-green-100 text-green-800 rounded-full"},Ne={class:"ml-4 text-right"},Se={key:1,class:"text-xs text-gray-500 mt-1"},qe={key:2,class:"text-xs text-gray-500 mt-1"},Ae={key:3,class:"text-xs text-gray-500 mt-1"},Fe={key:0,class:"mt-6 bg-gradient-to-r from-amber-50 to-yellow-50 rounded-lg p-6 border border-amber-200"},Me={class:"flex items-center justify-between mb-4"},Xe={class:"w-12 h-12 bg-amber-100 rounded-full flex items-center justify-center"},Be={class:"grid gap-4 md:grid-cols-3"},Le={class:"text-center p-4 bg-white rounded-lg border border-amber-200"},ze={class:"text-2xl font-bold text-amber-600 mb-1"},He={class:"text-center p-4 bg-white rounded-lg border border-amber-200"},$e={class:"text-2xl font-bold text-green-600 mb-1"},Ie={class:"text-center p-4 bg-white rounded-lg border border-amber-200"},Oe={class:"text-2xl font-bold text-purple-600 mb-1"},Ve={class:"mt-4 p-4 bg-white rounded-lg border border-amber-200"},We={class:"grid gap-2 md:grid-cols-2"},De={class:"flex items-center space-x-2"},Ge={class:"flex items-center space-x-2"},Ke={class:"flex items-center space-x-2"},Ye={class:"flex items-center space-x-2"},xt=H({__name:"MyPoints",setup(Je){var q;const M=$(),v=d=>{const t={bronze:{name:"برونزي",color:"bg-amber-100 text-amber-800",icon:"medal"},silver:{name:"فضي",color:"bg-gray-100 text-gray-800",icon:"medal"},gold:{name:"ذهبي",color:"bg-yellow-100 text-yellow-800",icon:"crown"},platinum:{name:"بلاتيني",color:"bg-blue-100 text-blue-800",icon:"star"},diamond:{name:"ماسي",color:"bg-purple-100 text-purple-800",icon:"gem"}};return t[d]||t.bronze},m=(q=M.props.auth)==null?void 0:q.user,b=i(!1),f=i(!1),h=i(!1),g=i(""),p=i(0),S=i(""),c=i(""),X=i(""),w=i(0),k=i(0),j=i([]),x=i([]),R=async()=>{var d;b.value=!0,g.value="";try{console.log("Loading points for user:",m.pointsys_customer_id);const t=await fetch("/user-points",{method:"GET",headers:{"X-Requested-With":"XMLHttpRequest",Accept:"application/json","X-CSRF-TOKEN":((d=document.querySelector('meta[name="csrf-token"]'))==null?void 0:d.getAttribute("content"))||""},credentials:"same-origin"});console.log("Response status:",t.status),console.log("Response headers:",t.headers);const s=await t.json();console.log("Response data:",s),t.ok&&s.success?(p.value=s.points||0,S.value=m.pointsys_customer_id,c.value=s.tier||"bronze",X.value=s.name||m.name,w.value=s.total_earned||0,k.value=s.total_redeemed||0,g.value="",s.message&&console.log("Points loaded successfully:",s.message)):(g.value=s.error||"Failed to fetch points balance",console.error("API Error:",s))}catch(t){console.error("Error loading points:",t),g.value="Network error. Please check your connection and try again."}finally{b.value=!1}},P=async()=>{var d;f.value=!0;try{const t=await fetch("/api/pointsys/rewards",{method:"GET",headers:{"X-Requested-With":"XMLHttpRequest",Accept:"application/json","X-CSRF-TOKEN":((d=document.querySelector('meta[name="csrf-token"]'))==null?void 0:d.getAttribute("content"))||""},credentials:"same-origin"}),s=await t.json();t.ok&&s.status==="success"?x.value=s.data||[]:x.value=[]}catch(t){console.error("Failed to load rewards:",t),x.value=[]}finally{f.value=!1}},B=async d=>{var t;if(!(m!=null&&m.pointsys_customer_id)){alert("You are not registered in the loyalty system. Please contact support.");return}h.value=!0;try{const s=await fetch("/api/pointsys/rewards/redeem",{method:"POST",headers:{"Content-Type":"application/json","X-Requested-With":"XMLHttpRequest",Accept:"application/json","X-CSRF-TOKEN":((t=document.querySelector('meta[name="csrf-token"]'))==null?void 0:t.getAttribute("content"))||""},credentials:"same-origin",body:JSON.stringify({reward_id:d,customer_id:m.pointsys_customer_id})}),T=await s.json();s.ok&&T.status==="success"?(await R(),alert("Reward redeemed successfully!")):alert(T.message||"Failed to redeem reward")}catch(s){console.error("Error redeeming reward:",s),alert("Network error. Please check your connection and try again.")}finally{h.value=!1}},L=()=>{j.value=[{id:1,description:"Car reservation - BMW X5",points:100,type:"earned",date:"2024-01-15"},{id:2,description:"Reward redemption - Free wash",points:50,type:"spent",date:"2024-01-10"},{id:3,description:"Car reservation - Mercedes C-Class",points:80,type:"earned",date:"2024-01-05"}]},z=async()=>{await Promise.all([R(),P()])};return I(()=>{setTimeout(()=>{R(),P(),L()},100)}),(d,t)=>(o(),A(O,null,{default:y(()=>[e("div",W,[e("div",D,[r(V,{title:"My Points",description:"View your loyalty points and rewards"}),e("div",G,[t[0]||(t[0]=e("div",{class:"flex items-center space-x-4"},[e("div",{class:"flex items-center space-x-2"},[e("div",{class:"w-3 h-3 bg-green-500 rounded-full"}),e("span",{class:"text-sm text-gray-600"},"Connected to PointSys")]),e("div",{class:"flex items-center space-x-2"},[e("div",{class:"w-3 h-3 bg-blue-500 rounded-full"}),e("span",{class:"text-sm text-gray-600"},"Real-time data")])],-1)),r(C,{onClick:z,variant:"outline",size:"sm",disabled:b.value||f.value},{default:y(()=>[r(n,{name:"refresh-cw",class:"w-4 h-4 mr-2"}),_(" "+l(b.value||f.value?"Refreshing...":"Refresh"),1)]),_:1},8,["disabled"])])]),e("div",K,[e("div",Y,[e("div",J,[t[1]||(t[1]=e("h3",{class:"text-lg font-semibold text-gray-900"},"Points Balance",-1)),e("div",Q,[r(n,{name:"star",class:"w-5 h-5 text-blue-600"})])]),b.value?(o(),a("div",U,t[2]||(t[2]=[e("div",{class:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto"},null,-1),e("p",{class:"text-gray-600 mt-2"},"Loading points...",-1)]))):g.value?(o(),a("div",Z,[r(n,{name:"alert-circle",class:"w-8 h-8 text-red-500 mx-auto mb-2"}),e("p",ee,l(g.value),1),r(C,{onClick:R,variant:"outline",class:"mt-2"},{default:y(()=>t[3]||(t[3]=[_(" Try Again ")])),_:1,__:[3]})])):(o(),a("div",te,[e("div",se,l(p.value),1),t[5]||(t[5]=e("p",{class:"text-gray-600"},"Available Points",-1)),c.value?(o(),a("div",oe,[e("span",{class:F(`px-3 py-1 text-sm font-medium rounded-full ${v(c.value).color}`)},[r(n,{name:v(c.value).icon,class:"w-4 h-4 inline mr-1"},null,8,["name"]),_(" "+l(v(c.value).name),1)],2)])):u("",!0),e("div",ae,[e("p",null,"Customer ID: "+l(S.value||"Not registered"),1),w.value>0?(o(),a("p",le,"Total Earned: "+l(w.value)+" pts",1)):u("",!0),k.value>0?(o(),a("p",re,"Total Redeemed: "+l(k.value)+" pts",1)):u("",!0)]),p.value===0?(o(),a("div",ne,t[4]||(t[4]=[e("p",{class:"text-sm text-yellow-800"},"Start earning points by making reservations!",-1)]))):u("",!0)]))]),e("div",ie,[e("div",de,[t[6]||(t[6]=e("h3",{class:"text-lg font-semibold text-gray-900"},"Recent Activity",-1)),e("div",ce,[r(n,{name:"activity",class:"w-5 h-5 text-green-600"})])]),b.value?(o(),a("div",ue,[(o(),a(E,null,N(3,s=>e("div",{key:s,class:"animate-pulse"},t[7]||(t[7]=[e("div",{class:"h-4 bg-gray-200 rounded w-3/4 mb-2"},null,-1),e("div",{class:"h-3 bg-gray-200 rounded w-1/2"},null,-1)]))),64))])):j.value.length===0?(o(),a("div",me,[r(n,{name:"inbox",class:"w-8 h-8 text-gray-400 mx-auto mb-2"}),t[8]||(t[8]=e("p",{class:"text-gray-600"},"No recent activity",-1))])):(o(),a("div",pe,[(o(!0),a(E,null,N(j.value.slice(0,5),s=>(o(),a("div",{key:s.id,class:"flex items-center justify-between p-3 bg-gray-50 rounded-lg"},[e("div",null,[e("p",xe,l(s.description),1),e("p",be,l(s.date),1)]),e("span",{class:F(["px-2 py-1 text-xs font-medium rounded-full",s.type==="earned"?"bg-green-100 text-green-800":"bg-red-100 text-red-800"])},l(s.type==="earned"?"+":"-")+l(s.points),3)]))),128))]))]),e("div",ge,[e("div",ve,[e("div",null,[t[9]||(t[9]=e("h3",{class:"text-lg font-semibold text-gray-900"},"Available Rewards",-1)),x.value.length>0?(o(),a("p",fe,l(x.value.length)+" rewards available",1)):u("",!0)]),e("div",ye,[r(n,{name:"gift",class:"w-5 h-5 text-purple-600"})])]),f.value?(o(),a("div",_e,t[10]||(t[10]=[e("div",{class:"animate-spin rounded-full h-8 w-8 border-b-2 border-purple-600 mx-auto"},null,-1),e("p",{class:"text-gray-600 mt-2"},"Loading rewards from PointSys...",-1)]))):x.value.length===0?(o(),a("div",he,[r(n,{name:"gift",class:"w-8 h-8 text-gray-400 mx-auto mb-2"}),t[12]||(t[12]=e("p",{class:"text-gray-600"},"No rewards available at the moment",-1)),t[13]||(t[13]=e("p",{class:"text-sm text-gray-500 mt-1"},"Check back later for new rewards!",-1)),r(C,{onClick:P,variant:"outline",size:"sm",class:"mt-3"},{default:y(()=>[r(n,{name:"refresh-cw",class:"w-4 h-4 mr-2"}),t[11]||(t[11]=_(" Refresh Rewards "))]),_:1,__:[11]})])):(o(),a("div",we,[(o(!0),a(E,null,N(x.value.slice(0,5),s=>(o(),a("div",{key:s.id,class:"p-3 bg-purple-50 rounded-lg border border-purple-200"},[e("div",ke,[e("div",Re,[e("p",Ce,l(s.title),1),e("p",je,l(s.description),1),e("div",Pe,[e("span",Te,l(s.points_required)+" pts ",1),s.status==="active"?(o(),a("span",Ee," Active ")):u("",!0)])]),e("div",Ne,[p.value>=s.points_required&&s.status==="active"?(o(),A(C,{key:0,size:"sm",variant:"outline",onClick:T=>B(s.id),disabled:h.value,class:"whitespace-nowrap"},{default:y(()=>[_(l(h.value?"Redeeming...":"Redeem"),1)]),_:2},1032,["onClick","disabled"])):p.value<s.points_required?(o(),a("p",Se," Need "+l(s.points_required-p.value)+" more pts ",1)):p.value===0?(o(),a("p",qe," Start earning points! ")):s.status!=="active"?(o(),a("p",Ae," Not available ")):u("",!0)])])]))),128))]))])]),c.value?(o(),a("div",Fe,[e("div",Me,[t[14]||(t[14]=e("div",null,[e("h3",{class:"text-lg font-semibold text-amber-900"},"Your Membership Level"),e("p",{class:"text-sm text-amber-700"},"Current tier and benefits")],-1)),e("div",Xe,[r(n,{name:v(c.value).icon,class:"w-6 h-6 text-amber-600"},null,8,["name"])])]),e("div",Be,[e("div",Le,[e("div",ze,l(v(c.value).name),1),t[15]||(t[15]=e("p",{class:"text-sm text-amber-700"},"Current Tier",-1))]),e("div",He,[e("div",$e,l(w.value),1),t[16]||(t[16]=e("p",{class:"text-sm text-green-700"},"Total Points Earned",-1))]),e("div",Ie,[e("div",Oe,l(k.value),1),t[17]||(t[17]=e("p",{class:"text-sm text-purple-700"},"Total Points Redeemed",-1))])]),e("div",Ve,[t[22]||(t[22]=e("h4",{class:"font-medium text-amber-900 mb-2"},"Tier Benefits:",-1)),e("div",We,[e("div",De,[r(n,{name:"check",class:"w-4 h-4 text-green-600"}),t[18]||(t[18]=e("span",{class:"text-sm text-amber-800"},"Access to all rewards",-1))]),e("div",Ge,[r(n,{name:"check",class:"w-4 h-4 text-green-600"}),t[19]||(t[19]=e("span",{class:"text-sm text-amber-800"},"Priority customer support",-1))]),e("div",Ke,[r(n,{name:"check",class:"w-4 h-4 text-green-600"}),t[20]||(t[20]=e("span",{class:"text-sm text-amber-800"},"Special promotions",-1))]),e("div",Ye,[r(n,{name:"check",class:"w-4 h-4 text-green-600"}),t[21]||(t[21]=e("span",{class:"text-sm text-amber-800"},"Exclusive offers",-1))])])])])):u("",!0),t[23]||(t[23]=e("div",{class:"mt-8 bg-blue-50 rounded-lg p-6 border border-blue-200"},[e("h3",{class:"text-lg font-semibold text-blue-900 mb-4"},"How to Earn Points"),e("div",{class:"grid gap-4 md:grid-cols-2 lg:grid-cols-3"},[e("div",{class:"flex items-start space-x-3"},[e("div",{class:"w-8 h-8 bg-blue-600 rounded-full flex items-center justify-center flex-shrink-0"},[e("span",{class:"text-white text-sm font-bold"},"1")]),e("div",null,[e("h4",{class:"font-medium text-blue-900"},"Make Reservations"),e("p",{class:"text-sm text-blue-700"},"Earn points for every car reservation")])]),e("div",{class:"flex items-start space-x-3"},[e("div",{class:"w-8 h-8 bg-blue-600 rounded-full flex items-center justify-center flex-shrink-0"},[e("span",{class:"text-white text-sm font-bold"},"2")]),e("div",null,[e("h4",{class:"font-medium text-blue-900"},"Complete Rentals"),e("p",{class:"text-sm text-blue-700"},"Get bonus points when you return cars on time")])]),e("div",{class:"flex items-start space-x-3"},[e("div",{class:"w-8 h-8 bg-blue-600 rounded-full flex items-center justify-center flex-shrink-0"},[e("span",{class:"text-white text-sm font-bold"},"3")]),e("div",null,[e("h4",{class:"font-medium text-blue-900"},"Refer Friends"),e("p",{class:"text-sm text-blue-700"},"Earn points for successful referrals")])])])],-1))])]),_:1}))}});export{xt as default};
